<div class="row" id="spells-panel">
  <div class="col-xs-12">
    <div class="h4">
      Spells<br/>
      <small>You can sort your spells by clicking on the headers. View the
    bottom of the list for a count of your prepared spells.</small>
    </div>
    <table class="listing table table-responsive table-ac-bordered table-hover"
           id="spellsTable">
      <thead>
        <tr>
          <th id="spellsTablePreparedHeader">
            <input id="filterByCastable"
                   type='checkbox'
                   class='filter-checkbox sr-only'
                   data-bind="checked: filteredByCastable"></input>
            <label for="filterByCastable"
                   class='fancy-checkbox-label'>
        <small>Memorized</small>
        </label>
          </th>
          <th id="spellsTableSpellHeader"
              data-bind="click: function(){sortBy('spellName');}">
            Spell
            <span data-bind="css: sortArrow('spellName')"></span>
          </th>
          <th id="spellsTableLevelHeader"
              data-bind="click: function(){sortBy('spellLevel');}">
            Level
            <span data-bind="css: sortArrow('spellLevel')"></span>
          </th>
          <th id="spellsTableTypeHeader"
              data-bind="click: function(){sortBy('spellTypeLabel');}">
            Type
            <span data-bind="css: sortArrow('spellTypeLabel')"></span>
          </th>
          <th id="spellsTableDamageHeader"
              data-bind="click: function(){sortBy('spellDmg');}">
            Damage
            <span data-bind="css: sortArrow('spellDmg')"></span>
          </th>
          <th id="spellsTableCastingHeader"
              data-bind="click: function(){sortBy('spellCastingTime');}">
            Casting Time
            <span data-bind="css: sortArrow('spellCastingTime')"></span>
          </th>
          <th id="spellsTableRangeHeader"
              data-bind="click: function(){sortBy('spellRange');}">
            Range
            <span data-bind="css: sortArrow('spellRange')"></span>
          </th>
          <th>
            <button class="btn btn-link"
                    data-bind="{click: collapseAll}">
        <span class="fa fa-minus"></span></button>
          </th>
        </tr>
      </thead>
      <tbody>
        <!-- ko foreach: filteredAndSortedSpells -->
        <tr
            data-toggle="collapse"
            class="clickable spellRow"
            data-bind="css: {notCastable: !spellIsCastable()}, attr:{'data-target': `#spell_list_${__id}`, id: `#spell_row_${__id}`}">
          <td class="memorize-spell"
              data-bind="click: $parent.memorizeSpell">
            <!-- ko ifnot: spellLevel() == 0  || spellAlwaysPrepared -->
            <div>
              <input type='checkbox'
                     style=""
                     class='pseudo-checkbox sr-only'
                     data-bind="checked: spellPrepared, attr: {id: `spell_memorize_${__id}`}"></input>
              <label data-bind="attr: {for: `spell_memorize_${__id}`}"
                     class='fancy-checkbox-label'>
            </label>
            </div>
            <!-- /ko -->
            <!-- ko if: spellLevel() == 0  || spellAlwaysPrepared -->
            <span class="glyphicon glyphicon-ok-sign"></span>
            <!-- /ko -->
          </td>
          <td>
            <span data-bind="text: spellName"></span>
            <!-- ko if: isConcentration -->
            <span style="color: #18bc9c"
                  class="glyphicon glyphicon-copyright-mark"></span>
            <!-- /ko -->
          </td>
          <td>
            <span data-bind="text: spellLevelLabel"></span>
          </td>
          <td><span data-bind="text: spellTypeLabel"></span></td>
          <td><span data-bind="text: spellDamageLabel"></span></td>
          <td><span data-bind="text: spellCastingTime"></span>
            <!-- ko if: isRitual -->
            <span style="color: #18bc9c"
                  class="glyphicon glyphicon-registration-mark"></span>
            <!-- /ko -->
          </td>
          <td><span data-bind="text: $component.trunc(spellRange, 10)"></span></td>
          <td>
            <span data-toggle="collapse"
                  data-bind="attr:{'data-target': `#spell_list_${__id}`}"
                  class="rotate fa fa-chevron-left"></span>
          </td>
        </tr>
        <tr style="backgound-color: white !important; height: 100%">
          <td colspan="8"
              style="position: relative; padding: 0px; height: 100%">

            <flip-card params="{
                  dataId: $data.__id,
                  collapsable: true,
                  elementId: 'spell_list',
                  context: {
                    data: $data,
                    remove: $component.removeSpell,
                  }
                }">
              <div class="front">
                <div data-bind="with: context.data, css: context.data.spellSchool().toLowerCase()">
                  <div class="h4" style="text-align: left">
                    <span data-bind="text: spellNameLabel"></span>&nbsp;
                    <small data-bind="text: spellSummaryLabel"></small>
                  </div>
                  <div class="row">
                    <div class="col-sm-3">
                      <table class="spellDetail table table-hover table-condensed table-ac-bordered">
                        <tbody>
                          <tr>
                            <th>Type:</th>
                            <td><span data-bind="text: spellType"></span></td>
                          </tr>
                          <!-- ko if: spellDamageLabel -->
                          <tr>
                            <th>Damage:</th>
                            <td><span data-bind="text: spellDamageLabel"></span></td>
                          </tr>
                          <!-- /ko -->
                          <tr>
                            <th>Casting Time:</th>
                            <td><span data-bind="text: spellCastingTime"></span></td>
                          </tr>
                          <tr>
                            <th>Range:</th>
                            <td><span data-bind="text: spellRange"></span></td>
                          </tr>
                          <tr>
                            <th>Duration:</th>
                            <td><span data-bind="text: spellDuration"></span></td>
                          </tr>
                          <tr>
                            <th>Components:</th>
                            <td><span data-bind="text: spellComponents"></span></td>
                          </tr>
                          <!-- ko if: spellMaterialComponents -->
                          <tr>
                            <td colspan="2"><i data-bind="text: spellMaterialComponents"></i></td>
                          </tr>
                          <!-- /ko -->
                        </tbody>
                      </table>
                    </div>
                    <div class="col-sm-9">
                      <div class="col-xs-12 col-padded">
                        <div style="text-align:justify" data-bind="html: spellDescriptionHTML"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="back">
                <div data-bind="css: context.data.spellSchool().toLowerCase()">
                <spell-form params="{
                      data: context.data,
                      containerId: elementId,
                      showForm: editMode,
                      toggle: toggleCallback,
                      remove: context.remove
                    }"></spell-form>
                  </div>
              </div>
            </flip-card>
          </td>
        </tr>
        <!-- /ko -->
        <!-- ko if: spellbook().length > 0 && filteredAndSortedSpells().length == 0 -->
        <tr class="clickable">
          <td href="#"
              colspan="8"
              class="text-center">
            No Spells are currently castable
          </td>
        </tr>
        <!-- /ko -->
        <tr id="add-spell" class="collapse">
          <td colspan="8">
              <spell-form params="{
                    data: null,
                    containerId: 'add-spell',
                    showForm: $component.showAddForm,
                    add: $component.addSpell,
                    toggle: $component.toggleAddForm
                  }"></spell-form>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="8">
                <div class="panel-footer"
                     style="position: relative">
                  <div style="left: 10px; top: 10px; position: absolute"
                       class="pull-left">Spells prepared:&nbsp;
                    <span data-bind="text: $component.numberOfPrepared"></span>
                  </div>
                  <center>
                    <button type="button"
                            class="btn btn-primary btn-sm"
                            id="spellsAddButton"

                            data-bind="click: $component.toggleAddForm, disable: $component.showAddForm">Add Spell</button>
                  </center>
                  <div style="right: 10px; top: 10px; position:absolute"
                       class="pull-right">Total Spells:&nbsp;
                    <span data-bind="text: $component.numberOfSpells"></span>
                  </div>
                </div>
              </div>
            </form>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
