<div>
	<div class="h4">
		Tracked Features, Feats, and Traits<br />
		<small>Configure to reset on a short or long rest.</small>
	</div>
	<table class="table table-responsive" style="border-width:0px">
		<thead>
			<tr>
				<th>Name
				</th>
				<th colspan="2">Resets on
				</th>
				<th></th>
				<th></th>
				<th>Used</th>
				<th>
					<button class="btn btn-link" data-bind="{click: collapseAll}">
			        <span class="fa fa-minus"></span></button>
				</th>
			</tr>
		</thead>
		<tbody>
			<!-- ko foreach: filteredAndSortedTrackables, as: trackable -->
			<tr data-bind="with: $data.tracked()">
				<td style="padding: 4px;"><span data-bind="html: $component.shortName($parent.name)"></span>
				</td>
				<td style="padding: 4px;">
					<!-- ko if: $component.needsResetsOnImg($data) -->
					<img class="action-bar-icon" data-bind="attr: { src: $component.resetsOnImgSource($data) }">
					</img>
					<!-- /ko -->
				</td>
				<td style="padding: 4px;">
					<mini-plus-minus params="value: used,
					max: maxUses, hideUp: true">
					</mini-plus-minus>
				</td>
				<td style="padding: 4px;">
					<mini-plus-minus params="value: used,
					max: maxUses, hideDown: true">
					</mini-plus-minus>
				</td>
				<td style="padding: 4px;">
					<div style="padding: 10px" data-bind="barProgress: $component.mapToChart($data)"> </div>
				</td>

				<td style="padding: 4px;">
					<span data-bind="text: parseInt(maxUses()) - parseInt(used())"></span>&nbsp;/&nbsp;<span data-bind=" text: maxUses"></span>
				</td>
				<td style="padding: 4px;">
					<span data-toggle="collapse" data-bind="attr:{'data-target': `#tracked_${__id}`}" class="rotate fa fa-chevron-left"></span>
				</td>
			</tr>
			<tr data-bind="with: $data.tracked()">
				<td colspan="8">
				<flip-card params="{
							viewData: $data,
							generateBlank: $component.generateBlank,
							collapsable: true,
							saveCallback: $component.dataHasChanged,
							remove: ()=>{},
							elementId: 'tracked',
							context: {
								parent: $parent,
								component: $component
							}
						}">
					<div class="front" data-bind="with: viewData">
						<div class="h4" style="text-align: left">
							<span data-bind="text: $parent.context.parent.name"></span>
							<small data-bind="text: $parent.context.component.nameMeta($parent.context.parent)"></small>
						</div>
						<p data-bind="markdownPreview: $parent.context.parent.description"></p>
					</div>
					<div class="back" data-bind="with: currentEditItem">
							<div class="h4" style="text-align: left">
								<span data-bind="text: $parent.context.parent.name"></span>
								<small data-bind="text: $parent.context.component.nameMeta($parent.context.parent)"></small>

							</div>

						<form class="form-horizontal">
							<div class="form-group">
								<label for="bonus" class="col-sm-3 control-label">Max</label>
								<div class="col-sm-9">
									<input type="number" class="form-control" id="max" min="1" data-bind='textInput: maxUses, hasFocus: $parent.formElementHasFocus'>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-3 control-label">Resets on...</label>
								<div class="col-sm-9">
									<div class="btn-group btn-group-justified btn-group-sm" role="group">
										<label class="btn btn-default btn-sm" data-bind="css: { active: resetsOn() == 'short'}">
											<input type="radio" class="hide-block"
											name="featureResetsOnShort" value="short" data-bind="checked: resetsOn"/>
											<img class="action-bar-icon" data-bind="attr: { src: $parent.context.component.meditationWhite }"></img>
											&nbsp;&nbsp;&nbsp;Short Rest
										</label>
										<label class="btn btn-default  btn-sm" data-bind="css: { active: resetsOn() == 'long'}">
											<input type="radio" class="hide-block"
											name="featureResetsOnLong" value="long" data-bind="checked: resetsOn"/>
											<img class="action-bar-icon" data-bind="attr: { src: $parent.context.component.campingTentWhite }"></img>
											&nbsp;&nbsp;&nbsp;Long Rest
										</label>
									</div>
								</div>
							</div>
						</form>
					</div>
				</flip-card>
			</td>
			</tr>
			<!-- /ko -->
			<!-- ko if: filteredAndSortedTrackables().length == 0 -->
			<tr class="clickable">
				<td colspan="12" class="text-center">
					No Tracked Features, Feats, or Traits to display.
				</td>
			</tr>
			<!-- /ko -->
		</tbody>
	</table>
</div>
